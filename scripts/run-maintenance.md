# 一键维护脚本 (One-Click Maintenance)

## 概述

`run-maintenance.js` 和 `run-maintenance.bat` 是一键执行整个项目维护流程的脚本，自动完成从测试到部署的所有步骤。

## 功能特性

- ✅ **自动依赖检查**：检查 Node.js 和 Python 是否安装
- ✅ **彩色输出**：清晰的进度显示和状态反馈
- ✅ **错误处理**：任何步骤失败时自动停止并显示错误信息
- ✅ **时间统计**：显示每个步骤和总体的执行时间
- ✅ **跨平台支持**：提供 Node.js 和 Windows 批处理两个版本

## 使用方法

### Node.js 版本（推荐，跨平台）

```bash
cd scripts
node run-maintenance.js
```

### Windows 批处理版本

```bash
cd scripts
run-maintenance.bat
```

## 执行流程

脚本会自动按顺序执行以下步骤：

1. **依赖检查** - 验证 Node.js 和 Python 环境
2. **步骤 1** - 运行测试，发现未收录关系
3. **步骤 2** - 同步缺失关系到代码
4. **步骤 3** - 规范化关系名称
5. **步骤 4** - 生成音频并上传到 GitHub

## 输出示例

```
🎯 关系计算器项目维护脚本
================================
🔍 检查依赖...
✅ Node.js: v18.17.0
✅ Python: Python 3.9.7

🚀 开始维护流程
================================

📋 步骤 1/4
🚀 运行测试，发现未收录关系
运行: 01-test\test.js
✅ 步骤 1 完成 (2.3s)

📋 步骤 2/4
🚀 同步缺失关系到代码
运行: 03-sync\sync-missing-to-index.js
✅ 步骤 2 完成 (1.1s)

📋 步骤 3/4
🚀 规范化关系名称
运行: 04-normalize\run-normalize.js
✅ 步骤 3 完成 (0.8s)

📋 步骤 4/4
🚀 生成音频并上传到 GitHub
运行: 05-audio\upload_to_github.py
✅ 步骤 4 完成 (45.2s)

================================
🎉 维护流程完成！
================================
✅ 成功完成: 4/4 个步骤
⏱️  总耗时: 49.4 秒

📋 完成的任务:
  • 测试关系计算逻辑
  • 同步缺失关系到代码
  • 规范化关系名称
  • 生成音频并上传到 GitHub

🚀 项目维护完成！音频文件已可通过 CDN 访问
```

## 错误处理

如果任何步骤失败，脚本会：

- 显示详细的错误信息
- 停止后续步骤的执行
- 提供修复建议
- 返回非零退出码

## 依赖要求

- **Node.js** 14.0+ （用于运行 JavaScript 脚本）
- **Python** 3.7+ （用于音频生成）
- **PaddleSpeech** （用于 TTS 功能）
- **GitPython** （用于 Git 操作）

## 注意事项

- 确保网络连接正常（用于 GitHub 上传）
- 确保有足够的磁盘空间（用于音频文件生成）
- 确保 GitHub 访问权限配置正确
- 建议在维护前备份重要文件

## 故障排除

### 常见问题

1. **Node.js 未找到**

   - 安装 Node.js 并确保在 PATH 中

2. **Python 未找到**

   - 安装 Python 并确保在 PATH 中

3. **PaddleSpeech 导入失败**

   - 运行 `pip install paddlespeech`

4. **Git 操作失败**

   - 检查 Git 配置和 GitHub 访问权限

5. **网络连接问题**
   - 检查网络连接和防火墙设置
