<view class="container {{isDark ? 'dark' : ''}}">
  <view class="navbar">
    <text class="title">ä¹ æƒ¯æ‰“å¡</text>
    <view class="navbar-actions">
      <button class="icon-btn" bindtap="onShowAddModal">â•</button>
      <button class="icon-btn" bindtap="onToggleTheme">{{isDark ? 'ğŸŒ™' : 'â˜€ï¸'}}</button>
    </view>
  </view>

  <view class="content">
    <!-- å½“å‰æ—¶é—´ -->
    <view class="time-card">
      <text class="time-label">ç°åœ¨æ—¶é—´</text>
      <text class="now-time">{{nowTime}}</text>
    </view>

    <!-- ä¹ æƒ¯åˆ—è¡¨ -->
    <view class="habits-list">
      <block wx:for="{{habits}}" wx:key="id">
        <view class="habit-card" style="border-left-color: {{item.color}}">
          <view class="habit-header">
            <view class="habit-info">
              <text class="habit-icon">{{item.icon}}</text>
              <view class="habit-name-wrapper">
                <text class="habit-name">{{item.name}}</text>
                <text class="habit-difficulty difficulty-{{item.difficulty}}">
                  {{item.difficulty === 'easy' ? 'ç®€å•' : item.difficulty === 'medium' ? 'ä¸­ç­‰' : 'å›°éš¾'}}
                </text>
              </view>
            </view>
            <view class="habit-actions">
              <button class="action-btn" bindtap="onEditHabit" data-id="{{item.id}}">âœï¸</button>
              <button class="action-btn" bindtap="onDeleteHabit" data-id="{{item.id}}">ğŸ—‘ï¸</button>
            </view>
          </view>

          <!-- ç»Ÿè®¡ä¿¡æ¯ï¼ˆåŠ¨æœºå¢å¼ºï¼‰ -->
          <view class="habit-stats">
            <view class="stat-item">
              <text class="stat-label">è¿ç»­</text>
              <text class="stat-value highlight">{{item.consecutiveDays}}å¤©</text>
            </view>
            <view class="stat-item">
              <text class="stat-label">æ€»è®¡</text>
              <text class="stat-value">{{item.totalDays}}å¤©</text>
            </view>
            <view class="stat-item">
              <text class="stat-label">æœ¬æœˆ</text>
              <text class="stat-value">{{item.monthProgress}}%</text>
            </view>
            <view class="stat-item" bindtap="onViewHabitDetail" data-id="{{item.id}}">
              <text class="stat-label">è¯¦æƒ…</text>
              <text class="stat-value">ğŸ“Š</text>
            </view>
          </view>

          <!-- è¿›åº¦æ¡ï¼ˆåŠ¨æœºå¯è§†åŒ–ï¼‰ -->
          <view class="progress-wrapper">
            <view class="progress-bar">
              <view class="progress-fill" style="width: {{item.monthProgress}}%; background-color: {{item.color}}"></view>
            </view>
          </view>

          <!-- æ‰“å¡æŒ‰é’®ï¼ˆèƒ½åŠ›ï¼šç®€åŒ–æ“ä½œï¼‰ -->
          <view class="checkin-section">
            <button 
              class="checkin-btn {{item.isTodayChecked ? 'checked' : ''}}" 
              style="background-color: {{item.isTodayChecked ? '#4cd964' : item.color}}"
              bindtap="{{item.isTodayChecked ? 'onUncheck' : 'onCheckIn'}}"
              data-id="{{item.id}}">
              {{item.isTodayChecked ? 'âœ“ å·²æ‰“å¡' : 'æ‰“å¡'}}
            </button>
            <text wx:if="{{item.reminderTime}}" class="reminder-text">â° {{item.reminderTime}}</text>
          </view>
        </view>
      </block>

      <!-- ç©ºçŠ¶æ€ -->
      <view wx:if="{{habits.length === 0}}" class="empty-state">
        <text class="empty-icon">ğŸ“</text>
        <text class="empty-text">è¿˜æ²¡æœ‰ä¹ æƒ¯</text>
        <text class="empty-hint">ç‚¹å‡»å³ä¸Šè§’ â• æ·»åŠ ä½ çš„ç¬¬ä¸€ä¸ªä¹ æƒ¯å§ï¼</text>
        <button class="btn-primary" bindtap="onShowAddModal">åˆ›å»ºä¹ æƒ¯</button>
      </view>
    </view>
  </view>

  <!-- æ·»åŠ /ç¼–è¾‘ä¹ æƒ¯å¼¹çª— -->
  <view wx:if="{{showAddModal}}" class="modal-overlay" bindtap="onCloseAddModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">{{editingHabit ? 'ç¼–è¾‘ä¹ æƒ¯' : 'æ–°å»ºä¹ æƒ¯'}}</text>
        <button class="modal-close" bindtap="onCloseAddModal">âœ•</button>
      </view>

      <view class="modal-body">
        <!-- ä¹ æƒ¯åç§° -->
        <view class="form-item">
          <text class="form-label">ä¹ æƒ¯åç§°</text>
          <input 
            class="form-input" 
            placeholder="ä¾‹å¦‚ï¼šæ¯å¤©è¿åŠ¨30åˆ†é’Ÿ"
            value="{{newHabit.name}}"
            bindinput="onHabitNameInput"
            maxlength="20" />
        </view>

        <!-- é€‰æ‹©å›¾æ ‡ -->
        <view class="form-item">
          <text class="form-label">å›¾æ ‡</text>
          <view class="icon-selector">
            <view 
              wx:for="{{['âœ…', 'ğŸƒ', 'ğŸ“š', 'ğŸ’§', 'ğŸ§˜', 'ğŸ¯', 'ğŸŒ±', 'ğŸ’ª', 'ğŸ“–', 'ğŸ¨', 'ğŸµ', 'ğŸ˜´']}}" 
              wx:key="*this"
              class="icon-option {{newHabit.icon === item ? 'selected' : ''}}"
              bindtap="onSelectIcon"
              data-icon="{{item}}">
              {{item}}
            </view>
          </view>
        </view>

        <!-- é€‰æ‹©é¢œè‰² -->
        <view class="form-item">
          <text class="form-label">ä¸»é¢˜è‰²</text>
          <view class="color-selector">
            <view 
              wx:for="{{['#007aff', '#34c759', '#ff9500', '#ff3b30', '#af52de', '#ff2d55', '#5856d6', '#00c7be']}}" 
              wx:key="*this"
              class="color-option {{newHabit.color === item ? 'selected' : ''}}"
              style="background-color: {{item}}"
              bindtap="onSelectColor"
              data-color="{{item}}">
              <text wx:if="{{newHabit.color === item}}" class="check-mark">âœ“</text>
            </view>
          </view>
        </view>

        <!-- é€‰æ‹©éš¾åº¦ï¼ˆèƒ½åŠ›ç»´åº¦ï¼‰ -->
        <view class="form-item">
          <text class="form-label">éš¾åº¦ï¼ˆèƒ½åŠ›ï¼‰</text>
          <view class="difficulty-selector">
            <view 
              class="difficulty-option {{newHabit.difficulty === 'easy' ? 'selected' : ''}}"
              bindtap="onSelectDifficulty"
              data-difficulty="easy">
              <text class="difficulty-label">ç®€å•</text>
              <text class="difficulty-desc">å®¹æ˜“å®Œæˆ</text>
            </view>
            <view 
              class="difficulty-option {{newHabit.difficulty === 'medium' ? 'selected' : ''}}"
              bindtap="onSelectDifficulty"
              data-difficulty="medium">
              <text class="difficulty-label">ä¸­ç­‰</text>
              <text class="difficulty-desc">éœ€è¦ä¸€å®šåŠªåŠ›</text>
            </view>
            <view 
              class="difficulty-option {{newHabit.difficulty === 'hard' ? 'selected' : ''}}"
              bindtap="onSelectDifficulty"
              data-difficulty="hard">
              <text class="difficulty-label">å›°éš¾</text>
              <text class="difficulty-desc">æŒ‘æˆ˜æ€§è¾ƒå¤§</text>
            </view>
          </view>
        </view>

        <!-- æé†’æ—¶é—´ï¼ˆè§¦å‘ï¼‰ -->
        <view class="form-item">
          <text class="form-label">æé†’æ—¶é—´ï¼ˆè§¦å‘ï¼‰</text>
          <picker 
            mode="time" 
            value="{{newHabit.reminderTime}}"
            bindchange="onReminderTimeChange">
            <view class="picker-wrapper">
              <text class="picker-text">{{newHabit.reminderTime || 'ä¸è®¾ç½®æé†’'}}</text>
              <text class="picker-arrow">â€º</text>
            </view>
          </picker>
        </view>
      </view>

      <view class="modal-footer">
        <button class="btn-cancel" bindtap="onCloseAddModal">å–æ¶ˆ</button>
        <button class="btn-save" bindtap="onSaveHabit">ä¿å­˜</button>
      </view>
    </view>
  </view>
</view>
